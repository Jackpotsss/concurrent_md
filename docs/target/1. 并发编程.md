# 1. 并发编程

线程之间的通信，对于程序员是完全透明的。

并发编程要解决多线程同时操作共享数据所引发的数据不安全问题，同时也要保证并发效率。

## 1.1 并发安全的措施

使程序并发安全的运行，方法策略不止一种，通常有以下三种策略：

1. 避免使用共享变量，每个线程在自己的私有变量上工作；
2. 如果有可能，把共享数据设计成常量，不可变状态的对象一定是线程安全的；
3. 使用多线程同步策略保证共享数据的安全；



​	本文大部分内容都在讲解第三种情况该如何处理，这也是最常见的一种情况，因为很多时候，我们需要让多个线程共同操作一份数据，又或者是因为业务需求不能把数据设置成常量，所以掌握多线程环境下并发编程的技巧显得尤为重要。

​	尽管使用同步策略保证线程安全是很有必要的，但也请不要忘记，这不是唯一的方法，在条件允许的情况下，方法一和方法二也是既简单又高效的解决方式。

## 1.2 同步机制



### 使用信号量实现互斥

**信号量和PV操作** 

​	为了解决并发编程中的安全问题，荷兰科学家 Dijkstra 最先提出**信号量和PV操作**的概念。信号量是一个非负整数的全局变量，并且只能由PV操作来处理；

​	PV操作是两个操作，即 P操作和 V操作，P操作和 V操作是在信号量上进行操作的两个过程。

​	信号量提供了一种非常方便的方式实现对共享变量的互斥访问。基本思想就是**将共享变量和一个信号量（非负整数）联系起来，然后用 两种特殊操作将相应的临界区包围起来。**

- P操作：如果信号量 s 是非零的，那么将s 减1，并立即返回。如果 s 为0，那么就阻塞这个线程，直到 s 变为非零。
- V操作：将信号量 s 加1。如果有任何线程阻塞等待 s 变为非零，那么该操作会唤醒这些线程中的一个。

以提供互斥为目的的信号量也叫**互斥锁**，P操作就是对互斥锁**加锁**，V操作是对互斥锁**解锁**。



上面的两种操作注意两点：

​	加锁和解锁过程中对信号量的加载、加1和存储信号是不能中断的，必须保证读-改-写操作的**原子性**。

​	而信号量的读和写也必须具有内存**可见性**，即线程总是能读到任意线程对该变量的最后一次写入，而线程对该变量的写入也必须立即刷新到主存中，并使其他线程对该变量的缓存失效。

注：

​	信号量不仅可以实现互斥，还能解决生产者-消费者问题（阻塞队列）、读者-写者问题（读写锁）。前提是这个信号量一定要保证内存可见性，对信号量更新的CAS操作也必须保证原子性。



### 使用对象监视器实现互斥

​	Java中的 `synchronized` 是通过**对象监视器**的机制来实现同步的，它其实是对信号量互斥和调度能力的更高级别的抽象；实际上，监控器可以用信号量来实现。



## 1.3 Dijkstra （迪科斯彻 ）

​	这里说的 Dijkstra 不是最短路径算法，而是一位非常牛的计算机科学家，大部分中国程序员记住这个名字是因为**最短路径算法【Dijkstra 算法】**，而这只是 Dijkstra 的发明之一。

​	**信号量、互斥**等并发概念最初都是在他的论文中出现的（并发编程的先锋人物）。

​	Dijkstra 是计算机领域最具有影响力的人物之一，也是计算机科学的奠基人之一。



<img src="https://gitee.com/Jackpotsss/pic_go/raw/master/img/image-20200312103619508.png" alt="image-20200312103619508"  />



## 1.4 Doug Lea（道格·利）

​	Java并发包（java.util.concurrent）的作者，被称为这个世界上对Java影响力最大的一个人。

​	Doug是一个无私的人，他深知分享知识和分享苹果是不一样的，苹果会越分越少，而自己的知识并不会因为给了别人就减少了，**知识的分享更能激荡出不一样的火花。**



<img src="https://gitee.com/Jackpotsss/pic_go/raw/master/img/image-20200312103517177.png" alt="image-20200312103517177"  />



​	在 《Effective Java 》第一版中，作者特别感谢了一个人- Doug Lea；在第二版中，作者特别感谢了两个人，其中一位是 Doug Lea；在第三版中，作者特别感谢了三个人，其中一位是 Doug Lea。

​	作者 Joshua Bloch 特别感谢 Doug Lea 无私的将其时间和知识都毫不保留地**分享**给他，在JDK 1.5 、1.6、 1.7 、1.8 版本的源码中，均有 Doug Lea  的参与，Joshua Bloch 和 Doug Lea 无论是在知识交流、撰写书籍还是JDK源码设计方面，都有非常密切的合作。JDK 很多重要的类也是由二人共同设计的（如 ThreadLocal，PriorityQueue等）。



